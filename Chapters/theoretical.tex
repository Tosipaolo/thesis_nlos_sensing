\chapter{ISAC for Cellular Networks}
\label{chap:theoretical_OFDM}

\gls{ofdm} has been adopted in the current generation of wireless communication systems and will be adopted for 6G as well.
OFDM splits the wireless signal into multiple subcarriers, each one modulated by a data stream. Multi carrier transmission offers numerous advantages such as high spectral efficiency and robustness to multipath fading. These factors make OFDM the ideal candidate for current and next generation high bit-rate applications and it is currently the standard waveform for LTE, 5G and in IEEE 802.11 (WiFi).

\section{Structure of OFDM signal}

OFDM efficiently distributes the signal over a discrete-time and discrete-frequency matrix. Each OFDM subcarrier is shaped using a rectangular window in the time domain, resulting in cardinal-sine-shaped carriers in the frequency domain \cite{Schaich_Wild_2014}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{Images/theoretical/ofdm/ofdm_psd_mod.png}
    \caption{Example of power spectral density of an OFDM signal with $N$ = 5.}
    \label{fig:quadtree}
\end{figure}

\subsection{Subcarriers and frequency spacing}
An OFDM system is based on the use of \textit{N} subcarriers, namely with frequencies $f_0$ to $f_{N-1}$, and $M$ time-slots that will limit the temporal length of the OFDM signal.
Each set of modulated data transmitted in a single time slot will be referred as an OFDM \textit{symbol}, while the entirety $N\times M$ symbols is referred to as an OFDM \textit{frame}.

Orthogonality of subcarriers is guaranteed by a frequency spacing $\Delta f$ of $1/T$, where $T$ is the duration of a single rectangular baseband pulse.
The time-domain signal can be expressed as

\begin{equation}
    s(t) = \sum_l\sum_{i=0}^{N-1} a_{i,l}\cdot \sqrt{\frac{1}{T}} \mathrm{rect} \left( \frac{t-T/2 - lT}{T} \right)\exp{\left(\frac{j2\pi it}{T}\right)},
\end{equation}

where $a_{i,l}$ is the complex QAM symbol modulating the \textit{i-th} subcarrier in the \textit{l-th} symbol interval.

\subsection{Implementation}
The relation between the discrete samples of OFDM in the time and frequency domain enables a beneficial implementation.
Sampling the signal at time $T/N$ we obtain a discrete version

\begin{equation}
    s_k = s(t)|_{t=k \frac{T}{N}} = \sqrt{\frac{1}{T}}\sum_{k=0}^{N-1} a_k \cdot e^{j2\pi ki/N},
\end{equation}

which is a \gls{dfs}. When \textit{N} is a power of 2, the \gls{dfs} can be implemented in an efficient way by the \gls{ifft} algorithm.
Binary data is transmitted by organizing it into $N$ parallel complex modulated symbols. These symbols are then mapped to subcarriers in the frequency domain, and the time domain signal is obtained by adding the cyclic prefix and using the \gls{ifft}. Figure \ref{fig:ofdm_transmit} shows the scheme for transmission of an \gls{ofdm} signal.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{Images/theoretical/ofdm/ofdm_transmit.png}
	\caption{OFDM transmitter scheme. \alert{MIGLIORA CAPTION}}
	\label{fig:ofdm_transmit}
\end{figure}

At the receiver, the time domain signal is sampled and each complex symbol is recovered by means of the \gls{fft} algorithm, as shown in Figure \ref{fig:ofdm_receive}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{Images/theoretical/ofdm/ofdm_receive.png}
	\caption{OFDM receiver scheme. \alert{MIGLIORA CAPTION}}
	\label{fig:ofdm_receive}
\end{figure}

\subsection{Guard interval and cyclic prefix}
A frequency selective channel will apply a time-dispersion effect on the OFDM signal. This causes each symbol to "leak" into the adjacent ones, leading to \gls{isi}.
In addition to \gls{isi}, also inter-carrier interference can be observed due to the loss of orthogonality of carriers.

\begin{figure}[t]
	\centering
	
	\subfloat[Effect of time delay on transmitted OFDM symbols. At the receiver, the first symbol is delayed and leaks into the FFT block of the following symbol.\label{fig:OFDM_no_cp_isi}]{%
		\includegraphics[scale=0.18]{Images/theoretical/ofdm/no_cp_isi.png}%
	}
	\vspace{0.5cm}
	\subfloat[Effect of time delay on symbols with CP. The delayed symbol is circularly shifted in the same FFT block. Symbol and delay can be resolved.\label{fig:OFDM_cp_isi}]{%
		\includegraphics[scale=0.18]{Images/theoretical/ofdm/cp_isi.png}%
	}
	
	\caption[]{Example of the working of cyclic prefix in OFDM.}
	\label{fig:OFDM_cyclic prefix}
\end{figure}

To avoid this effect, a guard interval is added to each \gls{ofdm} symbol. Typically its duration is $T_G = T/8$ or $T_G = T/4$, and the total \gls{ofdm} symbol duration then becomes $T_s = T + T_G$.
Due to the circular property of the discrete inverse Fourier transform, extending the time duration of the \gls{ofdm} symbol by a guard time is equivalent to prepending a copy of the last $T_G/T$ fraction of the symbol, resulting in the \gls{cp}.

% TODO: insert scheme of OFDM communication

A more thorough theoretical examination of \gls{ofdm}, multicarrier communications and their applications can be found in \cite{OFDMWireless}, \cite{Proakis_2001}.


\section{Signal processing for OFDM radar}
\label{sec:OFDM_radar_theory}
        
    During the radar operation each \gls{ofdm} frame is reflected by passive targets. The received signal is a superposition of the effect of the reflection of all the targets hit by the wave front, as described by Braun in Section 3.2 of \cite{Braun2014OFDMRA}. For the sake of practicality, this brief summary will use the same terminology and notation.
    The received signal when illuminating $H$ targets in an \gls{awgn} channel is then
    
    \begin{equation}
    \label{eq:received_signal_mltiple_targets}
        r(t) = \sum_{h=0}^{H-1} b_h s(t-\tau_h)e^{j2\pi f_{D,h}t}e^{j\hat{\varphi}_h} + z(t),
    \end{equation}
    
    where $s(t)$ is influenced by the following factors:
    
    \begin{itemize}
        \item Magnitude attenuation factor $$b_h = \sqrt{\frac{c_0\sigma_{RCS,h}}{(4\pi)^3 d_h^4f_C^2}},$$
    which depends on the distance of the target $d_h$, its \gls{rcs}, the speed of light $c_0$ and the carrier frequency $f_C$.
    
        \item Time delay $\tau_h = \frac{2d_h}{c_0},$ which is the round trip time of the reflected signal.
    
        \item A Doppler shift term introduced by the relative speed of the target $f_{D,h} = \frac{2v_{rel,h}}{c_0}f_C$.
        \item A random phase rotation $\varphi_h$.
        \item \gls{awgn} $\hat{z}(t)$.
    \end{itemize}
    
    Following Braun's notation \cite{Braun2014OFDMRA}, each transmitted \gls{ofdm} frame is indicated as
    \begin{equation}
        \mathbf F_{Tx} = \begin{pmatrix}
            a_{0,0} & \cdots & a_{0,M} \\
            a_{1,0} & \cdots & a_{1,M} \\
            \vdots   & \ddots & \vdots \\
            a_{N-1, 0} & \cdots & a_{N-1, M} \\
        \end{pmatrix} \in \mathbbm{C}^{N\times M},
    \end{equation}
    
    where rows are different subcarriers, columns are different time slots and $a$ is a symbol belonging to a complex modulation.
    The received frame matrix $\mathbf F_{Rx}$ is obtained by analog/digital conversion of the signal, removal of \gls{cp} from each OFDM symbol, and computing the \gls{fft} of length $N$ for every column of the matrix, as presented in Figure~\ref{fig:ofdm_receive}.
    
    \subsection{Effect of targets on OFDM frames}
    Figure \ref{fig:sensing_operation} depicts the scheme of a radar system.
    Each target reflection will affect different elements of the frame in a different way:
    \begin{enumerate}
        \item A Doppler frequency shift $f_D$ is equivalent to modulating the elements of each row of $\mathbf F_{Tx}$ by a factor $e^{j2\pi f_D T_S l},\quad  l = 0, \cdots, M-1$.
        \item A round trip delay $\tau$ will influence each subcarrier differently, based on its frequency. The corresponding phase shift on the k-th subcarrier is \\$e^{-j2\pi (k\Delta f + f_0)\tau} \quad  k = 0, \cdots, N-1$.
    \end{enumerate}
    For the single target case, $H=1$, the received OFDM frame will become
    \begin{equation}
        (\mathbf F_{Rx})_{k,l} = b_0(\mathbf F_{Tx})_{k,l} \cdot e^{j2\pi T_S f_{D,0} l}\cdot e^{-j2\pi k \tau_0 \Delta f} \cdot e^{j\varphi_0} + (\mathbf{\Tilde{Z}})_{k,l}.
    \end{equation}
    The received frame $\mathbf{F}_{Rx}$ contains contributions from the parameters $\tau$ and $f_D$, the phase and magnitude parameters $\varphi$ and $b$, and from the transmitted frame $\mathbf F_{Tx}$.
    The latter does not contribute to the sensing purpose, and it can be removed from $\mathbf F_{Rx}$ by element-wise division.
    The \gls{csi} $\mathbf F$ is obtained as
    \begin{equation}
        (\mathbf F)_{k,l} = \frac{(\mathbf F_{Rx})_{k,l}}{(\mathbf F_{Tx})_{k,l}} = b_0 \cdot e^{j2\pi T_S f_{D,0} l}\cdot e^{-j2\pi k \tau_0 \Delta f} \cdot e^{j\varphi_0} + \frac{(\mathbf{\Tilde{Z}})_{k,l}}{(\mathbf F_{Tx})_{k,l}}\label{eq:CSI_frame}.    
    \end{equation}
    An alternative noise matrix $(\mathbf{Z})_{k,l}$ can be defined since the noise process will be white if $(\mathbf{\Tilde{Z}})$ is white after division by the transmitted frame.
    Finally, we generalize the result to H targets by reintroducing the sum from~\eqref{eq:received_signal_mltiple_targets}:
    \begin{equation}
        (\mathbf F)_{k,l} =  \sum_{h=0}^{H-1} b_h \cdot e^{j2\pi T_S f_{D,h} l}\cdot e^{-j2\pi k \tau_h \Delta f} \cdot e^{j\varphi_h} + (\mathbf{Z})_{k,l}.
    \end{equation}
    
    \begin{figure}[t]
    	\centering
    	\includegraphics[width=0.9\textwidth]{Images/introduction/sensing_operation.png}
    	\caption{Schematic of a sensing (radar) system. Each target reflection affects the signal by introducing a round-trip delay $\tau$ and a Doppler shift $f_D$.}
    	\label{fig:sensing_operation}
    \end{figure}
    
    \subsection{Radar problem formulation}
    
    The estimation of the round-trip delay and of the Doppler shift for each target is equivalent to a spectral estimation problem. As Braun describes it \cite{Braun2014OFDMRA}: \textit{"Estimation of frequencies of a superposition of discretely sampled complex sinusoids, and their number"}.
    Multiple methods can be considered to solve this problem. They can be categorised as parametric, semiparametric, or nonparametric \cite{Stoica_New_Method_Parameter_Estimation}. 
    In the nonparametric class the most established method is the periodogram (also referred to as single-frequency least-squares method), which gives optimal results for sinusoids that are well resolved.
    Other established methods, which are more computationally expensive in general, are MUSIC and ESPRIT, belonging to the parametric class.
    
    \alert{This work focuses on spectral estimation based on the periodogram, which is a computationally efficient technique compared to MUSIC and ESPRIT.}
    The reduced computational complexity is crucial for the realization of a system that can process radar data in real-time without excessive overhead that may require specialized hardware.
    Although an efficient method for estimating the 2D MUSIC spectrum in 5G and 6G sensing have been proposed in \cite{Henninger_Mandelli_Arnold_EfficientMUSIC}, identifying eigenvalues corresponding to \gls{nlos} components among clutter returns from reflections can be challenging and processing time remains high due to the the large \gls{csi} and the number of targets in the scene.
    
    
    \subsection{Assumptions for OFDM radar systems}
    \label{sub:assumptions_ofdm_radar}
    The following assumptions on the \gls{isac} system simplify the design of the sensing algorithm, as described in section 3.2.1 of \cite{Braun2014OFDMRA}.
    
    \begin{enumerate}
    	\item No other distortion than \gls{awgn} is induced by the transmit and receive front-ends.
    	\item The \gls{cp} duration is larger than the round-trip propagation time for the furthermost target.
    	\item The subcarrier distance is at least one order of magnitude larger than the largest occurring Doppler shift.    	
    	\item The Doppler shift is the same on every subcarrier.
    	\item The target’s distance remains constant during the transmission of one frame.
    	
    	These assumptions are approximations of the actual conditions, as they are never exactly true for non-zero Doppler shifts. However, they are good approximations if the center frequency of the system is far greater then the total bandwidth and if the OFDM frames duration remains in the order of milliseconds.
    	Assumptions 2 and 3 ensure that the received matrix will not undergo de-orthogonalisation, which is necessary for element-wise division in Equation \eqref{eq:CSI_frame}. These conditions ensure that the \gls{ofdm} symbols are not delayed more than the \gls{cp} and are not shifted by a large Doppler shift. If these conditions are met, demodulation can occur correctly.
    \end{enumerate}
    
    \subsection{Non ambiguous range and speed}
    
        Due to the discrete nature of $\mathbf{F}$, range and speed measurements can be estimated without ambiguity if $|T_S f_D| < 1/2$ and $\tau \Delta f < 1$ are true.
        From this, the unambiguous range and speed values of the system can be derived as:
        
        \begin{itemize}
            \item Max unambiguous range
            \begin{equation}
            	d_{unamb} = \frac{c_0 \tau_{unamb}}{2} = \frac{c_0}{2\Delta f}.
            \end{equation}
            \item Max unambiguous speed
            \begin{equation}
				v_{unamb} = \frac{f_{D,unamb} c_0}{2f_C} = \frac{c_0}{2f_C T_S}.
			\end{equation}
        \end{itemize}
        
        As long as the target range and speed fall under $d < d_{unamb}$ and $|v| < v_{unamb}$ there will be no errors due to aliasing.
        
    \subsection{Range and speed resolution}
    
        Range and speed resolution depend on bandwidth and time aperture, respectively. These depend on the number of subcarriers and symbols in the \gls{ofdm} frame.
        
        \begin{itemize}
            \item Range resolution
            \begin{equation}
            	d_{res} =  \frac{c_0}{2\Delta f M}.
            \end{equation}
            \item Speed resolution
            \begin{equation}
            	v_{res} = \frac{c_0}{2 T_S f_C N}.
            \end{equation}
        \end{itemize}
        

        
\section{Periodogram-based estimation algorithms}
    
    A periodogram is defined as the estimator of the \gls{psd} of a signal.
    Considering a discrete-time signal $s(k)$ of length $N$ samples, the periodogram is defined as
    
    \begin{equation}
        \text{Per}_{s(k)}(f) = \frac{1}{N}\left| \sum_{k=0}^{N-1} s(k)e^{-j2\pi fk}\right|^2.
    \end{equation}

    The optimal way to obtain the periodogram in digital systems is by quantizing the frequency at regular intervals and using the \gls{fft} algorithm.

    \begin{align}
        \text{Per}_{s(k)}(f) &= \frac{1}{N}\left| \sum_{k=0}^{N-1} s(k)e^{-j2\pi \frac{nk}{N_{Per}}}\right|^2 \\
        &= \frac{1}{N}\left| \text{FFT}_{N_{Per}}[s(k)]\right|^2.
    \end{align}
    
    
    The transform is indicated as $\text{FFT}_{N_{per}}$ where $N_{Per} \geq N$ is the length of the \gls{fft}. When the input signal has $N < N_{Per}$, it is zero padded to the length of the \gls{fft}.
    The transform can be calculated in the most efficient way when $N_{Per}$ is a power of 2, hence it is recommended to zero-pad the input signal to the closest one.

    The input data for the periodogram is the \gls{csi} $\mathbf F$, and the periodogram is estimated in two dimensions

    \begin{equation}
    	\label{eq:periodogram_full}
    	\begin{aligned}
    		\text{Per}_{\mathbf F}(n,m) &= \frac{1}{NM} \left| \underbrace{ \sum_{k=0}^{N_{Per}-1}  \overbrace{\left(  \sum_{l=0}^{M_{Per}-1} (\mathbf F)_{k,l} e^{-j2\pi \frac{lm}{M_{Per}}} \right)}^{\text{N FFTs of length $M_{Per}$}}  e^{j2\pi\frac{kn}{N_{Per}}}}_{ \text{$M_{Per}$ iFFTs of length $N_{Per}$ }} \right| ^ 2 \\
    		&= \frac{1}{NM} \left| \text{CPer}_{\mathbf F}(n,m) \right| ^ 2.
    	\end{aligned}
    \end{equation}


    Each target captured in the CSI, \ie a sinusoid in $\mathbf F$, results in a peak in $Per_{\mathbf F}(n,m)$.
    For each target, the frequencies of its sinusoids $\hat{\Omega}_d$ (column-wise) and $\hat{\Omega}_v$ (row-wise) in $\mathbf F$ will correspond to peaks at position $(\hat{n}, \hat{m})$ in the periodogram. Inversely, if $\text{Per}_{\bm{F}}(\hat{n},\hat{m})$ is a peak value, then the corresponding oscillation frequencies in $\mathbf F$ are $\hat{\Omega}_d = 2\pi\hat{n}/N_{\text{Per}}$ column-wise and $\hat{\Omega}_v = 2\pi\hat{m}/M_{\text{Per}}$ row-wise.
    
    These frequencies are converted into distance and relative speed as

    \begin{equation}
        \hat{d} = \frac{1}{2}\hat{\tau}c_0 = \frac{\hat{\Omega}_d c_0}{2 (2\pi) \Delta f} = \frac{\hat{n}c_0}{2\Delta f N_\text{Per}}
    \end{equation}
    
    and
    \begin{equation}
    	\hat{v} = \frac{\hat{f}_D c_0 }{2 f_C} = \frac{\hat{\Omega}_v c_0}{2(2\pi)f_CT_S} =  \frac{\hat{m}c_0}{2f_cT_S M_{\text{Per}}}.,
    \end{equation}
    respectively.
    As demonstrated by Braun, computing the periodogram results in a \gls{snr} gain of a factor $NM$. The numerator in~\eqref{eq:periodogram_full} is an accumulation of all the elements in $\mathbf F$, whereas the denominator is a superposition of complex Gaussian random variables.
    
	\subsection{Window functions}
	
	Window functions are commonly applied to signals when computing the periodogram. This operation is done to tune the sidelobe level and enable precise detection of targets. 
	
	The two dimensional window matrix to be applied to the periodogram $\mathbf W \in \mathbb{R}^{N\times M}$ is multiplied element-wise with the matrix $\mathbf F$. When computing the periodogram, Equation~\eqref{eq:periodogram_full} becomes
	
	
	   \begin{align}
		\text{Per}_{\mathbf F}(n,m) &= \frac{1}{NM} \left| \underbrace{ \sum_{k=0}^{N_{Per}-1}  \overbrace{\left( \sum_{l=0}^{M_{Per}-1} (\bm{F})_{k,l} (\mathbf W)_{k,l} e^{-j2\pi \frac{lm}{M_{Per}}} \right)}^{\text{N FFTs of length $M_{Per}$}}  e^{j2\pi\frac{kn}{N_{Per}}}}_{ \text{$M_{Per}$ iFFTs of length $N_{Per}$ }} \right| ^ 2\\
		&= \frac{1}{NM} \left| \text{CPer}_{\bm{F}}(n,m) \right| ^ 2.
		\end{align}
	 
	 If no windowing is considered, then $(\mathbf W)_{k,l} = 1$ as in a simple boxcar window.
	 In the proposed \gls{ofdm} radar system, the following window types are of interest (Figure~\ref{fig:OFDMwin_functions})~\cite{Braun2014OFDMRA},~\cite{SASPWEB2011}:
	 
	 \begin{itemize}
	 	\item Rectangular (Boxcar) windows.
	 	\item Hamming windows.
	 	\item Hann windows.
	 	\item Dolph-Chebyshev windows.
	 \end{itemize}
	
	
	Since the width of the main lobe and the height of its peak is different from each window the windowing operation results in an \gls{snr} loss when computing the periodogram.
	The overall \gls{pg} can be updated as
	
	\begin{align}
		PG = 10\log_{10}(NM) + \text{SNR}_{\bm{w}_d} + \text{SNR}_{\bm{w}_v},
	\end{align}
	
	where the \gls{snr} for each direction is equal to the DC bin of the periodogram of each window normalized by the width of the rectangular window.
	
	\begin{figure}[H]
		\centering
		
		\subfloat[One-dimensional representation of the windows in time or frequency samples. Windows are normalized to unit energy.\label{fig:OFDMwin}]{%
			\includegraphics[scale=0.7]{Images/theoretical/windows/window_functs.eps}%
		}
		\vspace{0.5cm}
		\subfloat[Window functions in frequency domain, normalized to peak power of rectangular window.\label{fig:OFDMwin_freq}]{%
			\includegraphics[scale=0.7]{Images/theoretical/windows/window_functs_freq.eps}%
		}
		
		\caption[]{Window functions available for generating the periodogram.}
		\label{fig:OFDMwin_functions}
	\end{figure}
	
	
	
	
	\subsection{Welch's method}
	
	This method, also known as \gls{wosa}, is a method for reducing the noise of the estimated spectra, by averaging independent periodograms, in exchange for a reduction in frequency resolution.
	It is based on averaging of the periodograms after the segmentation of the data into smaller segments, with some overlap if windowing is adopted \cite{Welch_period}, \cite{Spagnolini_ch14}.
	The signal is divided into $K$ data segments of $J$ samples, the periodogram is then computed separately for each segment and then averaged.
	For a one-dimensional time signal $x(t)$ \cite{SASPWEB2011}, the $k$th windowed frame is
	
	\begin{align}
		x_k(j) = w(j)x(j + kR), \; k=0,1,\ldots, K-1, j=0,1,\ldots, J-1,
	\end{align}
	
	where $R$ is the window's hop size.
	After zero padding each frame to length $J'$, where $J' > J$, the $k$th windowed and zero padded frame becomes
		\begin{align}
		x_k(j) = w(j)x'(j + kR), \; k=0,1,\ldots, K-1, j=0,1,\ldots, J'-1.
	\end{align}
	The periodogram of the \textit{k}-th block is obtained as
	
	\begin{align}
		\text{PER}_{x_k,K}(w_k) = \frac{1}{K} |\text{FFT}_{J,k}(x_k)|^2 = \frac{1}{K}\left|\sum_{j=0}^{J-1}x_k(j)e^{-j2\pi jk/J}\right|^2.
	\end{align}
	
	The Welch estimate of the \gls{psd} is then given by
	
	\begin{align}
		\hat{S}^W_x(w_k) = \frac{1}{J}\sum_{k=0}^{K-1}\text{PER}_{x_k,K}(w_k).
	\end{align}
	
	The overall data can be windowed before computing the periodogram, reducing sidelobe level in the spectral estimate, at the expense of frequency resolution. If $w(j)$ is a rectangular window, then the periodograms are formed from non-overlapping successive blocks of data (we can refer to this case as Barlett's method). For different kinds of windows the hop size $R$ should not exceed half of the frame length $J/2$. In general $R$ is chosen so that consecutive windows overlap and add to a constant.
	
	
	

\section{ISAC Proof of Concept by Nokia}
\label{sec:intro-PoCarchitecture}

The architecture considered in this work is based on \gls{fr2} 5G commercially available communication hardware.
The system consists in a mmWave \gls{gnb} \gls{ru}, extended by a dedicated \gls{ru} called \textit{Sniffer} and a server called \gls{spu}. 
The Sniffer is synchronized with the \gls{gnb} by the same synchronization source \cite{Wild_Grudnitsky_Mandelli_Henninger_Guan_Schaich_2023}. 
A schematic representation of the PoC and its building blocks is shown in Figure \ref{fig:Overview_PoC_scheme}.

As presented in Section \ref{sec:OFDM_radar_theory}, in order to apply the OFDM radar approach, one must know the TX symbols at RX and obtain the CSI by removing their influence via element-wise division \cite{Braun2014OFDMRA}. 
Using Option 7-2 of the possible 5G splits \cite{Larsen_Checko_Christiansen_2019}, it is possible to use the same type of \gls{ru} for both communication and sensing.
Option 7-2 splits the network at the \gls{phy} level, which handles the conversion of digital data to the analogue radio signal in \gls{dl}, while doing the opposite in \gls{ul}.
This split defines the \gls{fft}/\gls{ifft} performed in the \gls{ru}, while the frequency domain IQ is transported on the fronthaul.
The \gls{spu} receives the complex IQ signal,  after \gls{fft} and removal of the \gls{cp}, as input for further sensing processing on a per-radio frame basis.

The \gls{gnb} \gls{ru} lacks full-duplex capabilities, hence it operates in \gls{tdd} mode, where \gls{ul} is separated from \gls{dl} by the allocation of different time slots in the same frequency band.
The Sniffer operates always in \gls{ul} mode, receiving both the signal transmitted by \glspl{ue} and the reflected signals. 

This work considers a \gls{poc} deployment where the primary \gls{gnb} \gls{ru} and the sniffer are mounted in proximity and are co-located, allowing the system to behave as a monostatic radar. 
The scope of this work does not cover the case of bistatic radar.

\begin{figure}[t]
	\centering
	\includegraphics[width=0.9\textwidth]{Images/overview/PoC_scheme.pdf}
	\caption{Schematic of ISAC PoC with processing blocks and interfaces. }
	\label{fig:Overview_PoC_scheme}
\end{figure}

The SPU processing chain for sensing is structured as follows:

\begin{itemize}
	\item \textit{Reference and reflected signal reception}. Receive and process packets from \gls{gnb} and Sniffer. Each radio frame has dimension $N\times M$, where $N$ is the number of subcarriers and $M$ the number of \gls{ofdm} symbols.
	\item \textit{Channel computation}. Channel information is obtained by division of the received by the transmitted frames.
	\item \textit{Clutter removal}. Before every measurement, the channel of the corresponding scenario without targets is saved during a calibration step and, based on that, the clutter components are removed from the reflected signal at runtime.
	\item \textit{Periodogram computation}. The spectral response of the channel information is obtained by computing $N$ \glspl{fft} followed by $M$ \glspl{ifft} on the result. The response is then converted in a 2D range-Doppler map of the observed targets. 
	\item \textit{Peak extraction}. Identifying the peaks in the periodogram allows to retrieve the range-speed information of targets present on the scene.
	\item \textit{Target tracking}. A \gls{kf} can be used to track the detected targets. 
\end{itemize} 
A more detailed description on how the processing chain is structured,  based on \cite{Braun2014OFDMRA}, will be presented in Chapter \ref{chap:theoretical_OFDM}.


The system specifications are indicated in table \ref{table:PoCparams}.
They correspond to parameters for 5G \gls{NR} systems with the numerology $\mu=3$ specified in \cite{TS138211}. 

The system is equipped with analog beamforming and measurements can be obtained using a fixed beam for both \gls{gnb} \gls{ru} and sniffer, chosen from a beam codebook.

\begin{table}[t]
	%\caption*{\textbf{Title of Table (optional)}}
	\centering 
	\caption{List of system parameters from Nokia proof of concept installation.}
	\label{table:PoCparams}
	\begin{tabular}{|p{9em} c c |}
		\hline
		\rowcolor{bluepoli!40} % comment this line to remove the color
		\textbf{Parameter} & \textbf{Description} & \textbf{Value}  \T\B \\
		\hline \hline
		$\mu$ & 5G numerology & 3 \T\B \\
		$f_C$ & carrier frequency & 27.4 GHz \T\B \\
		$B$ & bandwidth & 200 MHz \T\B\\
		$\Delta_f$ & subcarrier spacing & 120 kHz  \T\B\\
		$T_S = 1/\Delta_f + T_{CP}$ & symbol time & 8.92 $\mu s$  \T\B\\
		$T_{CP}$ & cyclic prefix time & 0.59 $\mu s$  \T\B\\
		$N$ & number of subcarriers & 1584  \T\B\\
		$M$ & number of symbols & 1120  \B\\
		
		\hline
	\end{tabular}
	\\[10pt]
\end{table}


    
    
    